%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#e3f2fd',
    'primaryTextColor': '#1a1a1a',
    'primaryBorderColor': '#90caf9',
    'lineColor': '#455a64'
  }
}}%%
flowchart LR
    %% Main unidirectional flow
    A["ğŸŒ <b>Request</b><br/><i>{store_id: 1, dept_id: 3}</i>"]
    B["ğŸ• <b>Get Online Features</b><br/><i>Feast Server â†’ PostgreSQL</i>"]
    C["âš™ï¸ <b>Scale Input</b><br/><i>StandardScaler.transform()</i>"]
    D["ğŸ¯ <b>Model Predict</b><br/><i>PyTorch MLP forward()</i>"]
    E["âš™ï¸ <b>Inverse Scale</b><br/><i>Convert to dollars</i>"]
    F["âœ… <b>Response</b><br/><i>$107,197</i>"]

    A -->|"entity"| B -->|"features"| C -->|"scaled"| D -->|"raw_pred"| E -->|"prediction"| F

    %% Infrastructure (below)
    KS["ğŸš€ KServe"]
    FS["ğŸ• Feast Server"]
    PG[("ğŸ˜ PostgreSQL")]
    PVC[("ğŸ’¾ Model + Scalers")]

    A -.->|"POST"| KS
    B -.->|"query"| FS
    FS -.->|"lookup"| PG
    C -.->|"load"| PVC
    D -.->|"load"| PVC

    style A fill:#e8f5e9,stroke:#81c784,stroke-width:2px
    style B fill:#e3f2fd,stroke:#90caf9,stroke-width:2px
    style C fill:#e3f2fd,stroke:#90caf9,stroke-width:2px
    style D fill:#fff3e0,stroke:#ffcc80,stroke-width:2px
    style E fill:#fff3e0,stroke:#ffcc80,stroke-width:2px
    style F fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    style KS fill:#fafafa,stroke:#bdbdbd
    style FS fill:#fafafa,stroke:#bdbdbd
    style PG fill:#fafafa,stroke:#bdbdbd
    style PVC fill:#fafafa,stroke:#bdbdbd
