%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f5e9', 'primaryTextColor': '#1a1a1a', 'primaryBorderColor': '#388e3c', 'lineColor': '#455a64'}}}%%
flowchart TB
    subgraph Notebook["üìì 03-inference.ipynb"]
        direction TB
        
        subgraph Setup["1Ô∏è‚É£ Setup"]
            S1["Configure Endpoint<br/>(KServe URL)"]
            S2["Health Check<br/>(/health)"]
        end
        
        subgraph Realtime["2Ô∏è‚É£ Real-time Inference"]
            R1["Single Request<br/>{store_id: 1, dept_id: 3}"]
            R2["KServe fetches from Feast<br/>(inference_features)"]
            R3["Return Prediction<br/>($107,197)"]
        end
        
        subgraph Batch["3Ô∏è‚É£ Batch Scoring"]
            B1["Generate All Entities<br/>(10 stores √ó 5 depts)"]
            B2["POST to same endpoint<br/>(multiple entities)"]
            B3["Save Predictions<br/>(parquet + CSV)"]
        end
    end

    subgraph Infra["Infrastructure"]
        KS["üöÄ KServe<br/>InferenceService"]
        FS["üçï Feature Server<br/>(REST API)"]
        PG[(PostgreSQL<br/>Online Store)]
        PVC[(Storage<br/>Predictions)]
    end

    S1 --> S2
    S2 --> R1 --> R2 --> R3
    R3 --> B1 --> B2 --> B3

    R2 --> KS
    KS --> FS
    FS --> PG
    B3 --> PVC

    User["üåê User / Client"]
    User -->|"entities"| R1
    R3 -->|"prediction"| User
    B2 -->|"batch"| KS

    style Notebook fill:#e8f5e9,stroke:#388e3c,color:#1a1a1a
    style Setup fill:#e3f2fd,stroke:#1976d2,color:#1a1a1a
    style Realtime fill:#fff3e0,stroke:#f57c00,color:#1a1a1a
    style Batch fill:#f3e5f5,stroke:#7b1fa2,color:#1a1a1a
    style Infra fill:#eceff1,stroke:#607d8b,color:#1a1a1a

