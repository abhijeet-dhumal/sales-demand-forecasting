%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#e3f2fd',
    'primaryTextColor': '#1a1a1a',
    'primaryBorderColor': '#90caf9',
    'lineColor': '#455a64'
  }
}}%%
flowchart LR
    %% Main unidirectional flow
    A["ğŸ“‚ <b>Raw Data</b><br/><i>Walmart sales CSV</i>"]
    B["âš™ï¸ <b>Feature Engineering</b><br/><i>lag_1, lag_4, rolling_mean</i>"]
    C["ğŸ’¾ <b>Save Parquet</b><br/><i>/shared/data/*.parquet</i>"]
    D["ğŸ• <b>feast apply</b><br/><i>Register to Feast</i>"]
    E["âš¡ <b>feast materialize</b><br/><i>Sync to Online Store</i>"]
    F["âœ… <b>Ready</b><br/><i>Training + Inference</i>"]

    A -->|"load"| B -->|"transform"| C -->|"register"| D -->|"sync"| E -->|"done"| F

    %% Infrastructure (below)
    PVC[("ğŸ’¾ Shared PVC")]
    PG[("ğŸ˜ PostgreSQL")]
    Ray["âš¡ KubeRay"]

    C -.->|"write"| PVC
    D -.->|"schema"| PG
    E -.->|"distributed"| Ray
    Ray -.->|"online features"| PG

    style A fill:#e8f5e9,stroke:#81c784,stroke-width:2px
    style B fill:#e3f2fd,stroke:#90caf9,stroke-width:2px
    style C fill:#e3f2fd,stroke:#90caf9,stroke-width:2px
    style D fill:#fff3e0,stroke:#ffcc80,stroke-width:2px
    style E fill:#f3e5f5,stroke:#ce93d8,stroke-width:2px
    style F fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    style PVC fill:#fafafa,stroke:#bdbdbd
    style PG fill:#fafafa,stroke:#bdbdbd
    style Ray fill:#fafafa,stroke:#bdbdbd
