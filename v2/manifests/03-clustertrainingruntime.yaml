# Custom ClusterTrainingRuntime with shared storage PVC
# Command/env come from TrainJob spec
apiVersion: trainer.kubeflow.org/v1alpha1
kind: ClusterTrainingRuntime
metadata:
  name: torch-with-storage
  labels:
    trainer.kubeflow.org/framework: torch
spec:
  mlPolicy:
    numNodes: 1
    torch:
      numProcPerNode: auto
  template:
    spec:
      replicatedJobs:
      - name: node
        replicas: 1
        template:
          metadata:
            labels:
              trainer.kubeflow.org/trainjob-ancestor-step: trainer
          spec:
            template:
              spec:
                volumes:
                - name: shared-storage
                  persistentVolumeClaim:
                    claimName: shared-storage
                containers:
                - name: node
                  image: registry.redhat.io/rhoai/odh-training-cuda128-torch28-py312-rhel9@sha256:bdc8cb781f005c11534a959fd57b8ba5133522e3bb4756d409e3111eeaf2e8ee
                  volumeMounts:
                  - name: shared-storage
                    mountPath: /shared
