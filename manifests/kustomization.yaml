# Sales Forecasting MLOps Pipeline
#
# Deploy infrastructure:
#   kubectl apply -k manifests/
#
# Then run jobs:
#   kubectl apply -f manifests/05-dataprep-job.yaml
#
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: feast-trainer-demo

labels:
- pairs:
    app.kubernetes.io/part-of: sales-forecasting-mlops
  includeSelectors: false

resources:
# Infrastructure (apply in order)
- 00-prereqs.yaml        # Namespace + shared PVC
- 00a-config.yaml        # Centralized configuration
- 01-postgres.yaml       # PostgreSQL
- 02-mlflow.yaml         # Standalone MLflow server
- 03-raycluster.yaml     # KubeRay cluster
- 04a-feast-rbac.yaml    # RBAC for Feast/Ray
- 04b-feast-server.yaml  # Feast server + UI
- 07-observability.yaml  # Quotas, NetworkPolicies, PDBs, Monitoring

# Jobs (apply separately after infrastructure is ready):
# - 05-dataprep-job.yaml   (make dataprep)
# - 06-trainjob.yaml       (make train)
# - 08-kserve-inference.yaml

# ConfigMaps generated from files
configMapGenerator:
- name: training-scripts
  files:
  - scripts/train_ddp.py
  options:
    disableNameSuffixHash: true
